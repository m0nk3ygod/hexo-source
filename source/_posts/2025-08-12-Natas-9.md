---
title: "Natas 9"
date: 2025-08-12 00:00:00 +0900
categories: [Overthewire, Natas]
tags: [overthewire, natas, web basic, study, basic php, passthru(), command injection, shell command]
---

# Natas 9 / write-up

<br>

접속 정보 
- URL : http://natas9.natas.labs.overthewire.org
- 사용자 이름 : natas9
- 비밀번호 : ~~ZE1ck82lmdGIoErlhQgWND6j2Wzz6b6t~~

<br>

접속하면,

![Natas9 figure1](/assets/img/natas/2025-08-10-11-03-29.png)

`Find words contanining(포함하는 단어 찾기)` 라는 문장과 함께 입력 받을 수 있는 **입력란**, 그리고 `Search` 버튼이 보인다.

그리고 `View sourcecode`라는 링크도 보였다.

<br>

소스 코드를 보기 전에, 일단 아무거나 입력하고 search를 눌러봤다.

![Natas9 figure2](/assets/img/natas/2025-08-10-11-15-42.png)

`banana`라고 입력하니 사진과 같이 나온다.

음... 무슨 동작을 하는지 정확하게 모르겠다. 아무래도 소스 코드를 봐야할 것 같다.

<br>

소스코드를 보니

![Natas9 figure3](/assets/img/natas/2025-08-10-11-17-57.png)

다음과 같이 나와 있었고, 내부 php 코드가 보여 이를 확인해 봤다.

```php
<?
$key = "";

if(array_key_exists("needle", $_REQUEST)) {
    $key = $_REQUEST["needle"];
}

if($key != "") {
    passthru("grep -i $key dictionary.txt");
}
?>
```

한줄 한줄 분석해보자!

```php
$key = "";
```
- key 변수를 빈 문자열로 초기화

```php
if(array_key_exists("needle", $_REQUEST)) {
    $key = $_REQUEST["needle"];
}
```
- `arrary_key_exists("needle:, $_REQUEST)` : 요청 파라미터에 `needle`이 존재하는지 확인
- 있을 경우 `needle` 값을 key 변수에 넣음

```php
if($key != "") {
    passthru("grep -i $key dictionary.txt");
}
```
- `if($key != "")` : key 변수가 비어있지 않을 경우 실행
- `passthru("grep -i $key dictionary.txt")` : key 변수에 들어있는 문자를 포함한 라인을 dictionary.txt에서 찾고 결과를 출력

<br>

여기서 가장 중요한, 취약한 부분은 `passthru()` 함수 부분이다.

**`passthru()`** 함수는 외부 명령을 실행하고 그 원본 출력을 그대로 브라우저로 내보내는 함수이다.

여기서는 `$key` 문자열에 대해 어떠한 검증 없이 명령에 쓰이고 있기에 **Command Injection** 취약점이 발생한다.

<br>

### Command Injection

Command Injection은 웹 애플리케이션이 사용자 입력을 서버의 시스템 명령어에 그대로 포함해 실행하는 취약점이다.

사용자 입력이 필터링되지 않고 명령어 문자열 안에 그대로 사용된다면,  
**추가 명령**을 입력으로 사용해 실행시킬 수 있다.

<br>

현재 `passtru()` 함수가 실행시키는 명령은 다음과 같다.

```bash
grep -i $key dictionary.txt
```

그렇다면 추가 명령은 어떻게 줄 수 있을까?

<br>

보통 명령어 구분자인 ";"(세미콜론)을 사용해 추가 명령을 주입한다.

```bash
command1 ; command2
```

예시와 같이 ";" 을 사용하면 `command1`이 실행되고,  
**결과에 상관 없이** `command2`가 실행된다.

<br>

`passthru()` 에서 사용된 `grep -i $key dictionary.txt`도 다음과 같이 추가 명령을 넣을 수 있을 것이다.

사용자 입력을 "; ls -al ;" 라고 준다면,

```bash
grep -i ; ls -al ; dictionary.txt
```

위 명령이 실행될 것이고, 다른 명령의 결과에 상관 없이 주입한 명령이 실행될 것이다.

즉, `grep -i` 명령과 `dictionary.txt` 가 오류가 나든 말든  
사용자가 주입한 **`ls -al`** 명령이 실행되어 서버 내부 디렉터리 구조를 보거나 읽는 등의 행위가 가능해진다!

<br>

실제로 해당 명령을 실행 시키면

![Natas9 figure4](/assets/img/natas/2025-08-10-12-39-50.png)

이런 식으로 명령이 잘 수행되는 것을 확인할 수 있다.

<br>

이제 다음 레벨로 가는 패스워드를 찾아보자!

찾고자 하는 패스워드는 natas10의 접속 패스워드이니  
natas10 을 키워드로 해서 find 명령을 써보았다.

```bash
; find / -name "*natas10*" ;
```
(입력한 명령)

실행해보니

![Natas9 figure5](/assets/img/natas/2025-08-10-12-46-05.png)

이런 결과들이 나왔다.

`natas_webpass` 폴더에 "pass"는 패스워드를 의미하는 것 같다.

`cat` 명령을 사용해서 해당 경로에 존재하는 파일을 읽어보면?

```bash
; cat /etc/natas_webpass/natas10 ;
```
(입력한 명령)

![Natas9 figure6](/assets/img/natas/2025-08-10-12-52-24.png)

찾았다 플래그.

<br>

- flag : ~~t7I5VHvpa14sJTUGV0cbEsbYfFP2dmOu~~
