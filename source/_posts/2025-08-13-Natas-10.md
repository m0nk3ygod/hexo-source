---
title: "Natas 10"
date: 2025-08-13 00:00:00 +0900
categories: ["< Overthewire >", Natas]
tags: [overthewire, natas, web basic, study, basic php, passthru(), grep, Regex]
---

# Natas 10 / write-up

<br>

접속 정보 
- URL : http://natas10.natas.labs.overthewire.org
- 사용자 이름 : natas10
- 비밀번호 : ~~t7I5VHvpa14sJTUGV0cbEsbYfFP2dmOu~~

<br>

접속하면,

![Natas10 figure1](/assets/img/natas/2025-08-10-14-14-41.png)

Natas9 레벨을 풀었을 때 처럼 `Find words contanining(포함하는 단어 찾기)` 라는 문장과 함께 입력 받을 수 있는 **입력란**, 그리고 `Search` 버튼이 보인다.

그리고 `View sourcecode`라는 링크도 보였다.

그런데 전에 없던 문구가 보였다

> For security reasons, we now filter on certain characters  
> (보안상의 이유로, 이제 특정 문자들을 필터링합니다)

소스 코드를 보기 전에, 일단 아무거나 입력하고 search를 눌러봤다.

![Natas10 figure2](/assets/img/natas/2025-08-10-23-55-28.png)

`banana`라고 입력하니 사진과 같이 나온다.

Natas9 레벨에서 동작한 것과 같이 사용자가 입력한 문자열이 dictionary.txt 같은 파일에 존재하는지 찾아보는 동작을 하는 것 같다.

<br>

이제 소스 코드를 확인해 보자.

![Natas10 figure3](/assets/img/natas/2025-08-10-23-57-04.png)

```php
<?
$key = "";

if(array_key_exists("needle", $_REQUEST)) {
    $key = $_REQUEST["needle"];
}

if($key != "") {
    if(preg_match('/[;|&]/',$key)) {
        print "Input contains an illegal character!";
    } else {
        passthru("grep -i $key dictionary.txt");
    }
}
?>
```
(내부 소스 코드 중 php 부분)

<br>

하나씩 분석해 보면

```php
$key = "";
```
- key 변수를 빈 문자열로 초기화

```php
if(array_key_exists("needle", $_REQUEST)) {
    $key = $_REQUEST["needle"];
}
```
- `arrary_key_exists("needle:, $_REQUEST)` : 요청 파라미터에 `needle`이 존재하는지 확인
- 있을 경우 `needle` 값을 key 변수에 넣음

```php
if($key != "")
```
- key 변수가 비어있지 않을 경우 실행

```php
if(preg_match('/[;|&]/',$key)) {
        print "Input contains an illegal character!";
    }
```
- key 변수에 들어있는 문자열들 퉁 ";", "|", "&" 가 있다면 1을 반환. (print 문 실행)

```php
passthru("grep -i $key dictionary.txt")
```
- key 변수에 들어있는 문자를 포함한 라인을 dictionary.txt에서 찾고 결과를 출력

다음과 같은 동작을 하고 있었다.

<br>

Natas9에서와 다르게 문제에 적혀있는 것처럼 **Command Injection**에 필요한 문자들을 필터링하고 있는 것을 볼 수 있었다.

그렇다면 어떻게 해야할까?

<br>

현재 필터링하고 있는 문자는  
";", "|", "&"   
이렇게 3개이다.

그리고 Natas 문제를 풀다보면 알 수 있는 점이 하나 있는데, 

바로 패스워드의 저장 위치가 동일하다 점이다.

<br>

Natas7 문제에서도, Natas9 에서도

항상 **`/etc/natas_webpass/natas N+1`** 위치에 다음 레벨의 패스워드(플래그)가 들어있는 것을 볼 수 있다.

이런 점도 활용해서 문제를 풀어보면 좋을 것 같다.

<br>

아무튼 문제로 돌아와서, 걸려있는 필터링 때문에 grep 이외에 다른 명령은 쓰기 어렵다.

그래서 `grep` 명령을 최대한 이용해야한다.

그러면 `grep` 명령에 대해 간단하게 살펴보자.

<br>

### grep command

`grep`(Global Regular Expression Print)는  
파일이나 입력에서 특정 문자열 또는 정규표현식 패턴을 검색해 해당 줄을 출력하는 명령이다.

기본적으로 줄 단위로 검색을 수행한다.

사용법은 다음과 같다.

```bash
grep [옵션] '패턴' 파일명
```

<br>

문제에서 쓰인 명령은 다음과 같다.

```bash
grep -i $key dictionry.txt
```

여기서 쓰인 `-i`는 **대소문자 구분 없이 검색**하겠다는 의미이다.

그리고 `key` 변수에는 패턴이 들어가게 되는데,  

해당 문제를 풀기 위해 정규표현식에서 사용되는 문자인 "."을 이용할 것이다.

<br>

### 정규 표현식 (Regular Expression, regex)

정규표현식이란 문자열에서 내가 원하는 패턴을 찾거나, 검사하거나, 바꾸기 위해 사용하는 **문자열 패턴 언어**를 말한다.

| 패턴      | 의미                             | 예시                  | 매칭 결과               |       |              |
| ------- | ------------------------------ | ------------------- | ------------------- | ----- | ------------ |
| `.`     | 임의의 문자 1개 (줄바꿈 제외)             | `c.t`               | `cat`, `cot`, `c t` |       |              |
| `*`     | 앞 문자가 0번 이상 반복                 | `go*`               | `g`, `go`, `goo`    |       |              |
| `+`     | 앞 문자가 1번 이상 반복 (**-E 필요**)     | `go+`               | `go`, `goo`         |       |              |
| `?`     | 앞 문자가 0번 또는 1번만 나옴 (**-E 필요**) | `colou?r`           | `color`, `colour`   |       |              |
| `^`     | 문자열(줄)의 시작                     | `^abc`              | `abc` (맨 앞에 있을 때만)  |       |              |
| `$`     | 문자열(줄)의 끝                      | `xyz$`              | `endxyz`            |       |              |
| `[]`    | 대괄호 안의 문자 중 하나                 | `[abc]`             | `a`, `b`, `c`       |       |              |
| `[^]`   | 대괄호 안의 문자를 제외                  | `[^0-9]`            | 숫자가 아닌 문자           |       |              |
| `-`     | 범위 지정 (대괄호 안에서 사용)             | `[a-z]`             | 소문자 a\~z            |       |              |
| `{n}`   | 앞 문자가 정확히 n번 반복 (**-E 필요**)    | `[0-9]{4}`          | 숫자 4자리              |       |              |
| `{n,}`  | 앞 문자가 최소 n번 반복 (**-E 필요**)     | `[0-9]{2,}`         | 숫자 2자리 이상           |       |              |
| `{n,m}` | 앞 문자가 n\~m번 반복 (**-E 필요**)     | `[0-9]{2,4}`        | 숫자 2\~4자리           |       |              |
| \`      | \`                             | OR (또는) (**-E 필요**) | `cat\|dog` 또는 \`cat | dog\` | `cat`, `dog` |
| `()`    | 그룹화 (**-E 필요**)                | `(ab)+`             | `ab`, `abab`        |       |              |
| `\`     | 특수문자 이스케이프                     | `\.`                | 마침표(`.`) 문자 자체      |       |              |

<br>

표에서도 볼 수 있듯 정규표현식에서 "."의 의미는 **아무 문자 한 개**를 뜻한다.

이걸 이용하면 **아무 문자 한 개**가 존재하는 줄을 출력해줄 것이니,  
사실상 빈줄을 제외하고 파일 내부의 줄을 모두 출력해주게 될 것이이다.

(`cat dictionary.txt` 같은 효과를 볼 수 있음)

<br>

근데 우리는 `dictionary.txt`가 보고 싶은게 아니다.

`/etc/natas_webpass/natas11` 에 적힌 내용을 보고 싶다.

그러니 다음과 같이 입력하여 해당 명령을 완성 시킬 수 있을 것이다.

$key : ". /etc/natas_webpass/natas11 " (마지막에 꼭 띄어쓰기 까지 해야함)

```bash
grep -i . /etc/natas_webpass/natas11 dictionary.txt
```

위 명령이 싫행되면  
`/etc/natas_webpass/natas11`과 `dictionary.txt`에서 패턴(아무 문자 한개가 들어간 줄)과 일치하는 줄들이 출력되어  
natas11의 패스워드를 얻을 수 있게 될 것이다.

<br>

실제로 입력해보면?

![Natas10 figure4](/assets/img/natas/2025-08-12-11-38-40.png)

찾았다 플래그.

<br>

flag : ~~UJdqkK1pTu6VLt9UHWAgRZz6sVUZ3lEk~~