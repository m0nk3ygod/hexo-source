---
title: "Natas 10"
date: 2025-08-10 00:00:00 +0900
categories: [Overthewire, Natas]
tags: [overthewire, natas, web basic, study, basic php, passthru(), command injection, shell command]
published: false
---

# Natas 10 / write-up

<br>

접속 정보 
- URL : http://natas10.natas.labs.overthewire.org
- 사용자 이름 : natas10
- 비밀번호 : ~~t7I5VHvpa14sJTUGV0cbEsbYfFP2dmOu~~

<br>

접속하면,

![Natas10 figure1](/assets/img/natas/2025-08-10-14-14-41.png)

Natas9 레벨을 풀었을 때 처럼 `Find words contanining(포함하는 단어 찾기)` 라는 문장과 함께 입력 받을 수 있는 **입력란**, 그리고 `Search` 버튼이 보인다.

그리고 `View sourcecode`라는 링크도 보였다.

그런데 전에 없던 문구가 보였다

> For security reasons, we now filter on certain characters  
> (보안상의 이유로, 이제 특정 문자들을 필터링합니다)

소스 코드를 보기 전에, 일단 아무거나 입력하고 search를 눌러봤다.

![Natas10 figure2](/assets/img/natas/2025-08-10-23-55-28.png)

`banana`라고 입력하니 사진과 같이 나온다.

Natas9 레벨에서 동작한 것과 같이 사용자가 입력한 문자열이 dictionary.txt 같은 파일에 존재하는지 찾아보는 동작을 하는 것 같다.

<br>

이제 소스 코드를 확인해 보자.

![Natas10 figure3](/assets/img/natas/2025-08-10-23-57-04.png)

```php
<?
$key = "";

if(array_key_exists("needle", $_REQUEST)) {
    $key = $_REQUEST["needle"];
}

if($key != "") {
    if(preg_match('/[;|&]/',$key)) {
        print "Input contains an illegal character!";
    } else {
        passthru("grep -i $key dictionary.txt");
    }
}
?>
```
(내부 소스 코드 중 php 부분)

<br>

하나씩 분석해 보면

```php
$key = "";
```
- key 변수를 빈 문자열로 초기화

```php
if(array_key_exists("needle", $_REQUEST)) {
    $key = $_REQUEST["needle"];
}
```
- `arrary_key_exists("needle:, $_REQUEST)` : 요청 파라미터에 `needle`이 존재하는지 확인
- 있을 경우 `needle` 값을 key 변수에 넣음

```php
if($key != "")
```
- key 변수가 비어있지 않을 경우 실행

```php
if(preg_match('/[;|&]/',$key)) {
        print "Input contains an illegal character!";
    }
```
- key 변수에 들어있는 문자열들 퉁 ";", "|", "&" 가 있다면 1을 반환. (print 문 실행)

```php
passthru("grep -i $key dictionary.txt")
```
- key 변수에 들어있는 문자를 포함한 라인을 dictionary.txt에서 찾고 결과를 출력

다음과 같은 동작을 하고 있었다.

<br>

Natas9에서와 다르게 문제에 적혀있는 것처럼 **Command Injection**에 필요한 문자들을 필터링하고 있는 것을 볼 수 있었다.

test



